package com.example.chatbot.common.interceptor;import com.example.chatbot.common.exception.ErrorCode;import com.example.chatbot.common.exception.UnauthorizedException;import jakarta.servlet.http.HttpServletRequest;import jakarta.servlet.http.HttpServletResponse;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Value;import org.springframework.stereotype.Component;import org.springframework.web.servlet.HandlerInterceptor;/** * API Key 인증 인터셉터 * * @author : 오승훈 * @fileName : ApiKeyInterceptor * @since : 2026-02-19 */@Slf4j@Componentpublic class ApiKeyInterceptor implements HandlerInterceptor {  @Value("${api.key}")  private String validApiKey;  @Override  public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {    // OPTIONS 요청은 통과 (CORS preflight)    if ("OPTIONS".equalsIgnoreCase(request.getMethod())) {      return true;    }    // API Key 헤더 확인    String apiKey = request.getHeader("X-API-Key");    // API Key 없음    if (apiKey == null || apiKey.isEmpty()) {      //log.warn("API Key 누락 - IP: {}, URI: {}", request.getRemoteAddr(), request.getRequestURI());      throw new UnauthorizedException(ErrorCode.MISSING_API_KEY);    }    // API Key 검증    if (!validApiKey.equals(apiKey)) {//      log.warn("유효하지 않은 API Key - IP: {}, URI: {}, Key: {}",//          request.getRemoteAddr(), request.getRequestURI(), apiKey);      throw new UnauthorizedException(ErrorCode.INVALID_API_KEY);    }    //log.debug("API Key 인증 성공 - URI: {}", request.getRequestURI());    return true;  }}