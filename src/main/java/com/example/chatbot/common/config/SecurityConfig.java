package com.example.chatbot.common.config;import com.example.chatbot.common.filter.JwtAuthenticationFilter;import jakarta.servlet.DispatcherType;import java.util.Arrays;import lombok.RequiredArgsConstructor;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.security.config.annotation.web.builders.HttpSecurity;import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;import org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;import org.springframework.security.config.http.SessionCreationPolicy;import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;import org.springframework.security.crypto.password.PasswordEncoder;import org.springframework.security.web.SecurityFilterChain;import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;import org.springframework.web.cors.CorsConfiguration;import org.springframework.web.cors.CorsConfigurationSource;import org.springframework.web.cors.UrlBasedCorsConfigurationSource;/** * Spring Security 설정 * * @author : 오승훈 * @fileName : SecurityConfig * @since : 2026-02-22 */@Configuration@EnableWebSecurity@RequiredArgsConstructorpublic class SecurityConfig {  private final JwtAuthenticationFilter jwtAuthenticationFilter;  @Bean  public PasswordEncoder passwordEncoder() {    return new BCryptPasswordEncoder();  }  /**   * CORS 설정 (추가)   */  @Bean  public CorsConfigurationSource corsConfigurationSource() {    CorsConfiguration configuration = new CorsConfiguration();    // 허용할 출처 (Railway 배포 주소 포함)    configuration.setAllowedOriginPatterns(Arrays.asList(        "http://localhost:8080",           // 로컬 백엔드 (Swagger)        "https://*.railway.app"            // Railway 배포 주소    ));    // 허용할 HTTP 메서드    configuration.setAllowedMethods(Arrays.asList(        "GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"    ));    // 허용할 헤더    configuration.setAllowedHeaders(Arrays.asList("*"));    // 인증 정보 포함 허용    configuration.setAllowCredentials(true);    // preflight 요청 캐싱 시간    configuration.setMaxAge(3600L);    UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();    source.registerCorsConfiguration("/**", configuration);    return source;  }  @Bean  public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {    http        // CORS 설정 적용 ← 추가        .cors(cors -> cors.configurationSource(corsConfigurationSource()))        // CSRF 비활성화 (JWT 사용)        .csrf(AbstractHttpConfigurer::disable)        // 세션 사용 안 함        .sessionManagement(session ->            session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))        // 경로별 권한 설정        .authorizeHttpRequests(auth -> auth            .dispatcherTypeMatchers(DispatcherType.ASYNC).permitAll() // swagger에서 실시간 스트리밍 테스트 위해            .requestMatchers("/api/auth/**").permitAll()  // 회원가입/로그인은 인증 불필요            .requestMatchers("/swagger-ui/**","/swagger-ui.html", "/v3/api-docs/**").permitAll()            .requestMatchers("/error").permitAll()            .anyRequest().authenticated()        )        .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);    return http.build();  }}