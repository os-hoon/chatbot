package com.example.chatbot.chat.controller;import com.example.chatbot.chat.dto.ChatRequest;import com.example.chatbot.chat.dto.ChatResponse;import com.example.chatbot.chat.dto.ConversationDeleteResponse;import com.example.chatbot.chat.dto.ConversationDetailResponse;import com.example.chatbot.chat.dto.ConversationListResponse;import com.example.chatbot.chat.service.ChatService;import java.util.List;import lombok.RequiredArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.springframework.http.MediaType;import org.springframework.http.ResponseEntity;import org.springframework.security.core.Authentication;import org.springframework.web.bind.annotation.*;import org.springframework.web.servlet.mvc.method.annotation.SseEmitter;/** * 채팅 API 컨트롤러 * * @author : 오승훈 * @fileName : ChatController * @since : 2026-02-05 */@Slf4j@RestController@RequestMapping("/api/chat")@RequiredArgsConstructorpublic class ChatController {  private final ChatService chatService;  /**   * 채팅 API   *   * @param request 사용자 메시지   * @return AI 응답   */  @PostMapping  public ResponseEntity<ChatResponse> chat(@RequestBody ChatRequest request, Authentication authentication) {    Long userId = (Long) authentication.getPrincipal();    log.info("채팅 요청 수신 - 사용자 ID: {}, 메시지: {}", userId, request.getMessage());    // ChatService를 통해 AI 응답 받기    ChatResponse response = chatService.chat(request.getMessage(),request.getConversationId(),userId);    return ResponseEntity.ok(response);  }  /**   * 채팅 스트리밍   */  @PostMapping(value = "/stream", produces = MediaType.TEXT_EVENT_STREAM_VALUE)  public SseEmitter chatStream(@RequestBody ChatRequest request,Authentication authentication) {    Long userId = (Long) authentication.getPrincipal();    log.info("채팅 스트리밍 요청 수신 - 사용자 ID: {}", userId);    return chatService.chatStream(        request.getMessage(),        request.getConversationId(),        userId    );  }  /**   * 대화 목록 조회   */  @GetMapping("/conversations")  public ResponseEntity<List<ConversationListResponse>> getConversations(Authentication authentication) {    Long userId = (Long) authentication.getPrincipal();    log.info("대화 목록 조회 요청 - 사용자 ID: {}", userId);    List<ConversationListResponse> conversations = chatService.getConversationList(userId);    return ResponseEntity.ok(conversations);  }  /**   * 대화 상세 조회 (메시지 포함)   */  @GetMapping("/conversations/{conversationId}")  public ResponseEntity<ConversationDetailResponse> getConversationDetail(      @PathVariable Long conversationId,      Authentication authentication) {    Long userId = (Long) authentication.getPrincipal();    log.info("대화 상세 조회 요청 - 대화 ID: {}", conversationId, userId);    ConversationDetailResponse response = chatService.getConversationDetail(conversationId, userId);    return ResponseEntity.ok(response);  }  /**   * 대화 삭제   */  @DeleteMapping("/conversations/{conversationId}")  public ResponseEntity<ConversationDeleteResponse> deleteConversation(      @PathVariable Long conversationId,      Authentication authentication) {    Long userId = (Long) authentication.getPrincipal();    log.info("대화 삭제 요청 - 대화 ID: {}, 사용자 ID: {}", conversationId, userId);    ConversationDeleteResponse response = chatService.deleteConversation(conversationId, userId);    return ResponseEntity.ok(response);  }  /**   * 대화 검색   */  @GetMapping("/conversations/search")  public ResponseEntity<List<ConversationListResponse>> searchConversations(      @RequestParam String keyword,      Authentication authentication) {    Long userId = (Long) authentication.getPrincipal();    log.info("대화 검색 요청 - 키워드: {}, 사용자 ID: {}", keyword, userId);    List<ConversationListResponse> conversations = chatService.searchConversations(keyword, userId);    return ResponseEntity.ok(conversations);  }}