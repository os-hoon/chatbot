package com.example.chatbot.openAI.service;import com.example.chatbot.common.exception.BusinessException;import com.example.chatbot.common.exception.ErrorCode;import com.example.chatbot.openAI.dto.AiMessage;import com.example.chatbot.openAI.dto.AiRequest;import com.example.chatbot.openAI.dto.AiResponse;import lombok.RequiredArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Value;import org.springframework.http.HttpEntity;import org.springframework.http.HttpHeaders;import org.springframework.http.MediaType;import org.springframework.stereotype.Service;import org.springframework.web.client.RestTemplate;import java.util.List;/** * OpenAI API 통신 서비스 * * @author : 오승훈 * @fileName : OpenAIService * @since : 2026-02-05 */@Slf4j@Service@RequiredArgsConstructorpublic class OpenAiService {  private final RestTemplate restTemplate;  @Value("${openai.api-url}")  private String apiUrl;  @Value("${openai.model}")  private String model;  public String getChatCompletion(List<AiMessage> messages) {    try {      // 1. 요청 DTO 생성      AiRequest request = new AiRequest(model, messages);      log.info("OpenAI API 요청 - 모델: {}, 메시지 개수: {}", model, messages.size());      HttpEntity<AiRequest> entity = new HttpEntity<>(request);      // 4. API 호출      AiResponse response = restTemplate.postForObject(          apiUrl,          entity,  // ← HttpEntity로 전달          AiResponse.class      );      // 5. 응답 처리      if (response != null && response.getChoices() != null && !response.getChoices().isEmpty()) {        String content = response.getChoices().get(0).getMessage().getContent();        log.info("OpenAI API 응답 성공 - 내용 길이: {}", content.length());        return content;      }      log.warn("OpenAI API 응답이 비어있습니다.");      return "응답을 생성할 수 없습니다.";    } catch (Exception e) {      log.error("OpenAI API 호출 중 오류 발생", e);      throw new BusinessException(ErrorCode.OPENAI_API_ERROR); //공통 에러 처리로 수정    }  }}