package com.example.chatbot.message.service;import com.example.chatbot.chat.entity.Conversation;import com.example.chatbot.message.dto.MessageResponse;import com.example.chatbot.message.entity.Message;import com.example.chatbot.message.entity.MessageRole;import com.example.chatbot.message.repository.MessageRepository;import java.util.List;import java.util.stream.Collectors;import lombok.RequiredArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;/** * message 서비스 클래스 * * @author : 오승훈 * @fileName : MessageService * @since : 2026-02-09 */@Slf4j@Service@RequiredArgsConstructor@Transactional(readOnly = true)public class MessageService {  private final MessageRepository messageRepository;  /**   * 사용자 메시지 저장   * MessageService → ChatService   * ->(Service 간 호출용이라 Entity 사용해도 문제 X)   */  @Transactional  public Message saveUserMessage(String content, Conversation conversation) {    Message message = Message.builder()        .role(MessageRole.USER)        .content(content)        .conversation(conversation)        .build();    return messageRepository.save(message);  }  /**   * AI 응답 메시지 저장   */  @Transactional  public Message saveAssistantMessage(String content, Conversation conversation) {    Message message = Message.builder()        .role(MessageRole.ASSISTANT)        .content(content)        .conversation(conversation)        .build();    return messageRepository.save(message);  }  /**   * 대화의 메시지 목록 조회   */  public List<MessageResponse> getMessagesByConversationId(Long conversationId) {    List<Message> messages = messageRepository        .findByConversationConversationIdOrderByCreatedAtAsc(conversationId);    return messages.stream()        .map(MessageResponse::from)        .collect(Collectors.toList());  }}