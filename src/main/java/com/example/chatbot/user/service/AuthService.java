package com.example.chatbot.user.service;import com.example.chatbot.common.exception.BusinessException;import com.example.chatbot.common.exception.DuplicateLoginIdException;import com.example.chatbot.common.exception.ErrorCode;import com.example.chatbot.common.exception.InvalidCredentialsException;import com.example.chatbot.common.util.JwtUtil;import com.example.chatbot.user.dto.LoginRequest;import com.example.chatbot.user.dto.LoginResponse;import com.example.chatbot.user.dto.SignupRequest;import com.example.chatbot.user.dto.SignupResponse;import com.example.chatbot.user.entity.User;import com.example.chatbot.user.repository.UserRepository;import lombok.RequiredArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.springframework.security.crypto.password.PasswordEncoder;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;/** * 인증 service 로직 * * @author : 오승훈 * @fileName : AuthService * @since : 2026-02-22 */@Slf4j@Service@RequiredArgsConstructor@Transactional(readOnly = true)public class AuthService {  private final UserRepository userRepository;  private final PasswordEncoder passwordEncoder;  private final JwtUtil jwtUtil;  /**   * 회원가입   */  @Transactional  public SignupResponse signup(SignupRequest request) {    log.info("회원가입 요청 - 로그인 ID: {}", request.getLoginId());    // 중복 체크    if (userRepository.existsByLoginId(request.getLoginId())) {      throw new DuplicateLoginIdException(request.getLoginId());    }    // 비밀번호 암호화    String encodedPassword = passwordEncoder.encode(request.getPassword());    // 사용자 생성    User user = User.builder()        .loginId(request.getLoginId())        .password(encodedPassword)        .name(request.getName())        .build();    User savedUser = userRepository.save(user);    log.info("회원가입 완료 - 사용자 ID: {}", savedUser.getUserId());    return SignupResponse.of(        savedUser.getUserId(),        savedUser.getLoginId(),        savedUser.getName()    );  }  /**   * 로그인   */  public LoginResponse login(LoginRequest request) {    log.info("로그인 요청 - 로그인 ID: {}", request.getLoginId());    // 사용자 조회    User user = userRepository.findByLoginId(request.getLoginId())        .orElseThrow(InvalidCredentialsException::new);    // 비밀번호 검증    if (!passwordEncoder.matches(request.getPassword(), user.getPassword())) {      throw new InvalidCredentialsException();    }    // JWT 토큰 생성    String token = jwtUtil.generateToken(user.getUserId(), user.getLoginId());    log.info("로그인 성공 - 사용자 ID: {}", user.getUserId());    return LoginResponse.of(        token,        user.getUserId(),        user.getLoginId(),        user.getName()    );  }}